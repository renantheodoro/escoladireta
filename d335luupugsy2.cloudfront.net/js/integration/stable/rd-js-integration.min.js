/*! Resultados Digitais - Fri Oct 13 2017 13:33:58 GMT-0300 (BRT) */
"use strict";function RDStationFormIntegration(n,e,t){RdIntegration.integrate(n,e,t)}var FormFields=function(){function n(n){for(var e=[],t=0;t<n.length;t+=1)e.push(n[t]);return e}function e(n){var e=jQuery(n).attr("name")||"",t=n.value,o=RDIntegrationCreditCard.validNumber(t);return!(u.indexOf(e.toLowerCase())>=0||o)}function t(t){var o=jQuery(t).find(":input").not(":password"),r=n(o),i=r.filter(e);return jQuery(i).serializeArray()}function o(n){return n.replace(/[\s_-]/g,"").toLowerCase().indexOf("email")>-1}function r(n,e){var t=!1,r=e[n.name];return r&&(t="email"===r.type),o(n.name)||t}function i(n,e){var t=!1;return jQuery.each(n,function(){if(r(this,e)&&""!==this.value)return this.name="email",t=!0,!1}),t}function a(t){return n(jQuery(t).find(":input").not(":password").not(":submit").not(":button").not(":reset").not(":checkbox").not(":radio")).filter(e)}var u=["captcha","_wpcf7","_wpcf7_version","_wpcf7_unit_tag","_wpnonce","_wpcf7_is_ajax_call","_wpcf7_locale","g-recaptcha-response","_viewstate","_previouspage","_viewstategenerator"];return{findEmail:i,singleFields:a,retrieveAllowedFields:t}}(),RDIntegrationCreditCard=function(){function n(n){var e,t,o,r=0,i=0;if("string"!=typeof n)return!1;if(t=n.replace(/\D/g,""),(o=t.length)<14)return!1;for(;o--;)e=parseInt(t.charAt(o),10)<<i,r+=e-9*(e>9),i^=1;return r%10==0&&r>0}return{validNumber:n}}();"undefined"!=typeof module&&module.hasOwnProperty("exports")&&(module.exports=RDIntegrationCreditCard);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},FieldMapping=function(){function n(){f=[]}function e(n){var e=void 0,t=void 0,o=n.getAttribute("name"),r=/\[/g,i=/\]/g;return!!o&&(e=o.replace(r,"_"),t=e.replace(i,""),"checkbox"===n.type?t+"[]":t)}function t(n){var e=jQuery('label[for="'+n.id+'"]')[0],t=jQuery(n).closest("label")[0],o=e||t;return!!o&&o.innerText.trim()}function o(n,o){var r=o.getAttribute("type"),i="Field "+n+" "+r;return e(o)||t(o)||o.getAttribute("id")||i}function r(n){jQuery(n).map(function(n,e){return f.push({name:o(n,e),value:e.value}),!1})}function i(n){r(FormFields.singleFields(n[0]))}function a(n){var e=n.find(":checkbox:checked[name]").clone();e.each(function(n,e){e.name=e.name.split(".")[0]}),r(e)}function u(n){r(n.find(":radio:checked"))}function c(e){return n(),i(e),a(e),u(e),f}var f=[];return{mapFields:c}}(),RdIntegrationIdentifier=function(){function n(n){var e=n[0].action;return"object"===(void 0===e?"undefined":_typeof(e))?e.value:void 0!==e?e:""}function e(e){var t,o=!1,r=["squarespace.com","realty_ajax_shortcode_contact_form"];for(t=0;t<r.length;t+=1)n(e).indexOf(r[t])>-1&&(o=!0);return o}function t(n){return!e(n)&&n.attr("id")}function o(n){var e="/"===window.location.pathname?"home":window.location.pathname;return n.attr("name")||t(n)||e}return{identifier:o}}(),RdIntegration=function(){var n,e,t,o,r,i,a=function(n){"undefined"==typeof jQuery?f("https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js",n):n()},u=function(n,e,t){a(function(){i=jQuery,c(n,e,t),l(),x()})},c=function(n,r,i){o=i||{},e=n,t=r},f=function(n,e){var t=document.getElementsByTagName("head")[0],o=document.createElement("script");o.type="text/javascript",o.src=n,o.onload=e,o.onreadystatechange=function(){"complete"===this.readyState&&e()},t.appendChild(o)},l=function(){i(":submit").click(s)},s=function(e){if(r=y(),n=d(e.target)){var t=FormFields.retrieveAllowedFields(n);if(FormFields.findEmail(t,n[0])){var o=m(t);("function"!=typeof n[0].checkValidity||n[0].checkValidity())&&(S(o,v),e.preventDefault())}}},d=function(n){return i(n).closest("form:not([data-internal-rdstation-form])")},m=function(n){var e=p(n);return e.push(r.identifier,r.token,b()),e},p=function(n){return o.fieldMapping&&(n=g(n)),n},g=function(n){return i.each(n,function(){var n=o.fieldMapping[this.name];n&&(this.name=n)}),n},v=function(){h(n)?n.submit():n.find(":submit").unbind("click",s).click()},h=function(n){var e=n.attr("action");return void 0!==e&&""!==e.trim()},y=function(){return{identifier:{name:"identificador",value:t},token:{name:"token_rdstation",value:e}}},_=function(n){var e,t,o=document.cookie.split(";");for(n+="=",e=0;e<o.length;e++){for(t=o[e];" "===t.charAt(0);)t=t.substring(1,t.length);if(0===t.indexOf(n))return t.substring(n.length,t.length)}return null},b=function(){return{name:"query_params",value:location.search.substring(1)}},F=function(){var n=_("rdtrk");if(null!==n)return n=JSON.parse(unescape(n)),n.id},w=function(n){var e=F();return void 0!==e&&n.push({name:"client_id",value:e}),n},j=function(n){return n.push({name:"c_utmz",value:_("__utmz")}),n.push({name:"traffic_source",value:_("__trf.src")}),n},I=function(n,e){return n.push({name:"_is",value:e}),n},S=function(n,e,t){var o;t=t||3,o=10===t?"form-integrations":"conversions",n=w(n),n=j(n),n=I(n,t),a(function(){jQuery.ajax({type:"POST",url:"https://www.rdstation.com.br/api/1.3/"+o,data:n,crossDomain:!0,xhrFields:{withCredentials:!0},warn:function(n){console.log("ERROR - "),console.log(n)},complete:function(n,t){e&&e(n,t)},beforeSend:function(){}})})},x=function(){!0===o.debugMode&&k()},k=function(){a(function(){i=jQuery,o=o||{},console.info("Iniciando");var n=i(_getElementSubmit()),e=d(n);0===n.length?console.warn("Nenhum botao de submit encontrado"):console.info("Botoes de submit encontrados: "+n.length),0===e.length?console.warn("Nenhum formulario encontrado"):console.info("Formularios encontrados: "+e.length),Q(e),console.info("Finalizado")})},Q=function(n){r=y(),i.each(n,function(n,e){var t=m(e),o=[];console.log(""),console.info(n+1+" formulario"),FormFields.findEmail(e)?console.info("Campo de email encontrado"):console.warn("Campo de email nao encontrado"),i.each(t,function(n,e){o.push(e.name)}),console.info("Campos mapeados: "+o.join(", "))}),console.log("")},R=function(n,t){o=t||{},e=n,a(function(){localStorage.getItem("RdIntegrationFormData")&&N(),C()})},C=function(){var n=jQuery('form:not(:has(input[name="_is"]))');jQuery(n).submit(D)},D=function(n){var e=jQuery(n.target).closest("form"),o=FieldMapping.mapFields(e);FormFields.findEmail(o,e[0])&&(t=RdIntegrationIdentifier.identifier(e),O(o))},O=function(n){n=A(n),E(n),S(n,function(n){M(n)},10)},A=function(n){return n.push({name:"identificador",value:t},{name:"token_rdstation",value:e},{name:"form_url",value:location.href.split("?")[0]},{name:"page_title",value:document.title}),n},E=function(n){localStorage.setItem("RdIntegrationFormData",JSON.stringify(n))},N=function(){var n=JSON.parse(localStorage.getItem("RdIntegrationFormData"));S(n,function(n){M(n)},10)},M=function(n){4===n.readyState&&localStorage.removeItem("RdIntegrationFormData")};return{integrate:u,post:S,analyse:k,integrateAll:R}}();